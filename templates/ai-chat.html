<!-- templates/ai-chat.html -->
<!-- INLINE AI CHAT SECTION -->
<section class="ai-chat-section" id="ai-chat">
    <div class="container">
        <div class="section-title">
            <h2><i class="fas fa-robot"></i> Elmed Wellmind Solutions AI Mental Health Assistant</h2>
            <p>Chat directly with our AI assistant for immediate mental health support, coping strategies, and information.</p>
        </div>

        <div class="ai-chat-main-wrapper">
            <!-- Left Side: Quick Actions & Features -->
            <div class="ai-chat-sidebar-left">
                <!-- Quick Questions Card -->
                <div class="chat-feature-card quick-questions-card">
                    <div class="feature-card-header">
                        <i class="fas fa-bolt feature-icon"></i>
                        <h3>Quick Topics</h3>
                    </div>
                    <p class="feature-card-subtitle">Tap any topic to start a conversation</p>
                    <div class="quick-questions-grid">
                        <div class="quick-question-btn" data-question="I'm feeling anxious today">
                            <div class="quick-btn-icon">
                                <i class="fas fa-heartbeat"></i>
                            </div>
                            <span>Anxiety Support</span>
                        </div>
                        <div class="quick-question-btn" data-question="How can I manage stress?">
                            <div class="quick-btn-icon">
                                <i class="fas fa-brain"></i>
                            </div>
                            <span>Stress Management</span>
                        </div>
                        <div class="quick-question-btn" data-question="I'm having trouble sleeping">
                            <div class="quick-btn-icon">
                                <i class="fas fa-bed"></i>
                            </div>
                            <span>Sleep Issues</span>
                        </div>
                        <div class="quick-question-btn" data-question="Tips for self-care">
                            <div class="quick-btn-icon">
                                <i class="fas fa-heart"></i>
                            </div>
                            <span>Self-Care Tips</span>
                        </div>
                        <div class="quick-question-btn" data-question="How to support a friend with depression">
                            <div class="quick-btn-icon">
                                <i class="fas fa-hands-helping"></i>
                            </div>
                            <span>Supporting Others</span>
                        </div>
                        <div class="quick-question-btn" data-question="I'm feeling depressed and unmotivated">
                            <div class="quick-btn-icon">
                                <i class="fas fa-cloud"></i>
                            </div>
                            <span>Depression Support</span>
                        </div>
                    </div>
                </div>

                <!-- Features Card -->
                <div class="chat-feature-card features-card">
                    <div class="feature-card-header">
                        <i class="fas fa-star feature-icon"></i>
                        <h3>Key Features</h3>
                    </div>
                    <div class="features-grid">
                        <div class="feature-item">
                            <div class="feature-icon-wrapper">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="feature-text">
                                <h4>100% Confidential</h4>
                                <p>Your privacy is protected</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon-wrapper">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="feature-text">
                                <h4>24/7 Available</h4>
                                <p>Always here for you</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon-wrapper">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div class="feature-text">
                                <h4>Evidence-Based</h4>
                                <p>Research-backed guidance</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon-wrapper">
                                <i class="fas fa-globe-africa"></i>
                            </div>
                            <div class="feature-text">
                                <h4>Kenyan Context</h4>
                                <p>Culturally relevant support</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Center: Main Chat Container -->
            <div class="ai-chat-container">
                <div class="ai-chat-header">
                    <div class="chat-header-content">
                        <div class="chat-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="chat-header-text">
                            <h3>Elmed Wellmind Solutions Health Assistant is online</h3>
                            <p>How can I support you today?</p>
                        </div>
                        <div class="chat-status">
                            <span class="status-dot"></span>
                            <span>Online</span>
                        </div>
                    </div>
                    <div class="ai-chat-disclaimer">
                        <i class="fas fa-exclamation-triangle"></i> 
                        <strong>Important:</strong> This AI provides general support only. Not a substitute for professional medical advice.
                    </div>
                </div>
                
                <div class="ai-chat-body">
                    <div class="ai-chat-messages" id="aiChatMessages">
                        <!-- Chat messages will be loaded here -->
                        <div class="chat-message bot-message">
                            <div class="message-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="message-content">
                                <div class="message-text">
                                    Hello! I'm ElmedWellmindSolutions AI. I am your AI mental health assistant. I'm here to provide supportive information, coping strategies, and general mental health guidance. How can I help you today?
                                </div>
                                <div class="message-time">Just now</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input-area">
                        <div class="chat-input-wrapper">
                            <textarea id="chatMessageInput" placeholder="Type your message here... What's on your mind? You can talk about stress, anxiety, relationships, or any mental health concern."></textarea>
                            <button id="sendChatButton">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <div class="typing-indicator" id="typingIndicator">
                            <span></span><span></span><span></span> Thinking...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Side: Emergency & Info -->
            <div class="ai-chat-sidebar-right">
                <!-- Emergency Contact Card -->
                <div class="chat-feature-card emergency-card">
                    <div class="feature-card-header emergency-header">
                        <i class="fas fa-phone-alt feature-icon"></i>
                        <h3>Emergency Support</h3>
                    </div>
                    <p class="emergency-subtitle">For immediate help, contact our team:</p>
                    
                    <div class="emergency-contacts">
                        <a href="tel:+254759226354" class="emergency-contact-btn phone-btn">
                            <div class="emergency-icon">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div class="emergency-text">
                                <h4>Call Now</h4>
                                <p>+254 759 226354</p>
                            </div>
                        </a>
                        
                        <a href="https://wa.me/254759226354" target="_blank" class="emergency-contact-btn whatsapp-btn">
                            <div class="emergency-icon">
                                <i class="fab fa-whatsapp"></i>
                            </div>
                            <div class="emergency-text">
                                <h4>WhatsApp</h4>
                                <p>24/7 Support</p>
                            </div>
                        </a>
                        
                        <div class="emergency-note">
                            <i class="fas fa-info-circle"></i>
                            <p>Available 24/7 for mental health emergencies</p>
                        </div>
                    </div>
                </div>

                <!-- Chat Tips Card -->
                <div class="chat-feature-card tips-card">
                    <div class="feature-card-header">
                        <i class="fas fa-lightbulb feature-icon"></i>
                        <h3>Chat Tips</h3>
                    </div>
                    <div class="tips-list">
                        <div class="tip-item">
                            <div class="tip-number">1</div>
                            <p>Be specific about how you're feeling</p>
                        </div>
                        <div class="tip-item">
                            <div class="tip-number">2</div>
                            <p>Share what triggers your concerns</p>
                        </div>
                        <div class="tip-item">
                            <div class="tip-number">3</div>
                            <p>Ask for coping strategies</p>
                        </div>
                        <div class="tip-item">
                            <div class="tip-number">4</div>
                            <p>Remember this is not medical advice</p>
                        </div>
                    </div>
                </div>

                <!-- Statistics Card -->
                <div class="chat-feature-card stats-card">
                    <div class="feature-card-header">
                        <i class="fas fa-chart-line feature-icon"></i>
                        <h3>Today's Activity</h3>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number" id="activeUsers">250+</div>
                            <div class="stat-label">Active Users</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="avgResponse">2.3s</div>
                            <div class="stat-label">Avg Response Time</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="satisfaction">98%</div>
                            <div class="stat-label">Satisfaction</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    /* INLINE AI CHAT SECTION - MODERN DESIGN */
    .ai-chat-section {
        padding: 120px 0;
        background: linear-gradient(135deg, #f5f7ff 0%, #eef1ff 100%);
        position: relative;
    }

    .ai-chat-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, var(--primary), transparent);
    }

    .ai-chat-main-wrapper {
        display: flex;
        gap: 25px;
        max-width: 1400px;
        margin: 0 auto;
    }

    /* Sidebars */
    .ai-chat-sidebar-left,
    .ai-chat-sidebar-right {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 25px;
        min-width: 280px;
    }

    /* Main Chat Container */
    .ai-chat-container {
        flex: 2;
        background: white;
        border-radius: 24px;
        box-shadow: 0 20px 60px rgba(108, 99, 255, 0.12);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        min-height: 700px;
        border: 1px solid rgba(108, 99, 255, 0.1);
    }

    /* Feature Cards */
    .chat-feature-card {
        background: white;
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(108, 99, 255, 0.08);
        transition: all 0.3s ease;
    }

    .chat-feature-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 50px rgba(108, 99, 255, 0.15);
        border-color: rgba(108, 99, 255, 0.2);
    }

    .feature-card-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
    }

    .feature-icon {
        width: 45px;
        height: 45px;
        background: var(--gradient-primary);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
    }

    .feature-card-header h3 {
        font-size: 1.4rem;
        color: var(--dark);
        margin: 0;
    }

    .feature-card-subtitle {
        color: #666;
        font-size: 0.95rem;
        margin-bottom: 20px;
        line-height: 1.5;
    }

    /* Quick Questions */
    .quick-questions-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }

    .quick-question-btn {
        background: #f8f9ff;
        border: 2px solid #eef0ff;
        border-radius: 16px;
        padding: 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
    }

    .quick-question-btn:hover {
        background: var(--gradient-primary);
        border-color: var(--primary);
        transform: translateY(-3px);
    }

    .quick-question-btn:hover .quick-btn-icon,
    .quick-question-btn:hover span {
        color: white;
    }

    .quick-btn-icon {
        width: 40px;
        height: 40px;
        background: rgba(108, 99, 255, 0.1);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--primary);
        font-size: 1.2rem;
        transition: all 0.3s ease;
    }

    .quick-question-btn span {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--dark);
        transition: all 0.3s ease;
    }

    /* Features Grid */
    .features-grid {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .feature-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        background: #fafbff;
        border-radius: 14px;
        transition: all 0.3s ease;
    }

    .feature-item:hover {
        background: rgba(108, 99, 255, 0.05);
        transform: translateX(5px);
    }

    .feature-icon-wrapper {
        width: 45px;
        height: 45px;
        background: var(--gradient-primary);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.1rem;
        flex-shrink: 0;
    }

    .feature-text h4 {
        font-size: 1rem;
        color: var(--dark);
        margin-bottom: 5px;
    }

    .feature-text p {
        font-size: 0.85rem;
        color: #666;
        margin: 0;
    }

    /* Chat Header */
    .ai-chat-header {
        background: linear-gradient(135deg, var(--primary) 0%, #764ba2 100%);
        color: white;
        padding: 25px 30px;
    }

    .chat-header-content {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 15px;
    }

    .chat-avatar {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        backdrop-filter: blur(10px);
    }

    .chat-header-text h3 {
        font-size: 1.6rem;
        color: white;
        margin: 0 0 5px 0;
    }

    .chat-header-text p {
        color: rgba(255, 255, 255, 0.9);
        margin: 0;
        font-size: 1rem;
    }

    .chat-status {
        margin-left: auto;
        display: flex;
        align-items: center;
        gap: 8px;
        background: rgba(255, 255, 255, 0.15);
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.9rem;
    }

    .status-dot {
        width: 8px;
        height: 8px;
        background: #4CC9A7;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }

    .ai-chat-disclaimer {
        background: rgba(255, 255, 255, 0.15);
        border-left: 3px solid #FF6B6B;
        padding: 12px 15px;
        border-radius: 8px;
        font-size: 0.9rem;
        display: flex;
        align-items: flex-start;
        gap: 10px;
    }

    /* Chat Messages */
    .ai-chat-body {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 0;
    }

    .ai-chat-messages {
        flex: 1;
        padding: 25px;
        background: #fafbff;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        max-height: 450px;
    }

    .ai-chat-messages::-webkit-scrollbar {
        width: 6px;
    }

    .ai-chat-messages::-webkit-scrollbar-track {
        background: #f0f2ff;
        border-radius: 10px;
    }

    .ai-chat-messages::-webkit-scrollbar-thumb {
        background: var(--primary);
        border-radius: 10px;
    }

    .chat-message {
        margin-bottom: 20px;
        display: flex;
        animation: fadeInUp 0.3s ease;
    }

    .user-message {
        justify-content: flex-end;
    }

    .message-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        flex-shrink: 0;
        background: var(--gradient-primary);
        color: white;
        font-size: 1rem;
    }

    .user-message .message-avatar {
        order: 2;
        margin-right: 0;
        margin-left: 15px;
        background: var(--gradient-secondary);
    }

    .message-content {
        max-width: 70%;
        position: relative;
    }

    .user-message .message-content {
        text-align: right;
    }

    .message-text {
        padding: 15px 20px;
        border-radius: 20px;
        line-height: 1.6;
        font-size: 0.95rem;
        position: relative;
    }

    .bot-message .message-text {
        background: white;
        color: var(--dark);
        border-bottom-left-radius: 5px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        border: 1px solid #eef0ff;
    }

    .user-message .message-text {
        background: var(--gradient-primary);
        color: white;
        border-bottom-right-radius: 5px;
        box-shadow: 0 5px 15px rgba(108, 99, 255, 0.2);
    }

    .message-time {
        font-size: 0.75rem;
        color: #999;
        margin-top: 5px;
        padding: 0 5px;
    }

    /* Chat Input */
    .chat-input-area {
        padding: 20px 25px;
        border-top: 1px solid #eef0ff;
        background: white;
    }

    .chat-input-wrapper {
        display: flex;
        gap: 15px;
        align-items: flex-end;
    }

    #chatMessageInput {
        flex: 1;
        padding: 18px 25px;
        border: 2px solid #eef0ff;
        border-radius: 20px;
        font-family: 'Montserrat', sans-serif;
        font-size: 1rem;
        transition: all 0.3s;
        resize: none;
        min-height: 60px;
        max-height: 120px;
        background: #fafbff;
    }

    #chatMessageInput:focus {
        outline: none;
        border-color: var(--primary);
        background: white;
        box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.1);
    }

    #sendChatButton {
        width: 55px;
        height: 55px;
        background: var(--gradient-primary);
        color: white;
        border: none;
        border-radius: 50%;
        font-size: 1.2rem;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    #sendChatButton:hover:not(:disabled) {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 10px 25px rgba(108, 99, 255, 0.3);
    }

    #sendChatButton:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .typing-indicator {
        display: none;
        padding: 12px 20px;
        background: white;
        border-radius: 20px;
        margin-top: 15px;
        width: fit-content;
        border: 1px solid #eef0ff;
        font-size: 0.9rem;
        color: var(--primary);
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    .typing-indicator span {
        display: inline-block;
        width: 8px;
        height: 8px;
        background: var(--primary);
        border-radius: 50%;
        margin: 0 2px;
        animation: typing 1.4s infinite;
    }

    /* Emergency Card */
    .emergency-header .feature-icon {
        background: var(--gradient-secondary);
    }

    .emergency-subtitle {
        color: #666;
        font-size: 0.95rem;
        margin-bottom: 20px;
        line-height: 1.5;
    }

    .emergency-contacts {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .emergency-contact-btn {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 18px;
        border-radius: 16px;
        text-decoration: none;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }

    .phone-btn {
        background: rgba(108, 99, 255, 0.08);
        border-color: rgba(108, 99, 255, 0.2);
    }

    .phone-btn:hover {
        background: var(--gradient-primary);
        border-color: var(--primary);
        transform: translateY(-3px);
    }

    .phone-btn:hover .emergency-text h4,
    .phone-btn:hover .emergency-text p {
        color: white;
    }

    .whatsapp-btn {
        background: rgba(37, 211, 102, 0.08);
        border-color: rgba(37, 211, 102, 0.2);
    }

    .whatsapp-btn:hover {
        background: #25D366;
        border-color: #1DA851;
        transform: translateY(-3px);
    }

    .whatsapp-btn:hover .emergency-text h4,
    .whatsapp-btn:hover .emergency-text p {
        color: white;
    }

    .emergency-icon {
        width: 45px;
        height: 45px;
        background: var(--gradient-primary);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
        flex-shrink: 0;
    }

    .whatsapp-btn .emergency-icon {
        background: #25D366;
    }

    .emergency-text h4 {
        font-size: 1rem;
        color: var(--dark);
        margin-bottom: 5px;
    }

    .emergency-text p {
        font-size: 0.9rem;
        color: #666;
        margin: 0;
    }

    .emergency-note {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        padding: 15px;
        background: rgba(255, 101, 132, 0.08);
        border-radius: 12px;
        margin-top: 10px;
        border: 1px solid rgba(255, 101, 132, 0.2);
    }

    .emergency-note i {
        color: var(--secondary);
        font-size: 1rem;
        margin-top: 2px;
    }

    .emergency-note p {
        font-size: 0.85rem;
        color: #666;
        margin: 0;
        line-height: 1.5;
    }

    /* Tips Card */
    .tips-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .tip-item {
        display: flex;
        align-items: flex-start;
        gap: 15px;
        padding: 15px;
        background: #fafbff;
        border-radius: 14px;
        transition: all 0.3s ease;
    }

    .tip-item:hover {
        background: rgba(108, 99, 255, 0.05);
        transform: translateX(5px);
    }

    .tip-number {
        width: 30px;
        height: 30px;
        background: var(--gradient-primary);
        color: white;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.9rem;
        flex-shrink: 0;
    }

    .tip-item p {
        margin: 0;
        font-size: 0.9rem;
        color: #555;
        line-height: 1.5;
    }

    /* Stats Card */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
    }

    .stat-item {
        text-align: center;
        padding: 15px;
        background: #fafbff;
        border-radius: 14px;
        transition: all 0.3s ease;
    }

    .stat-item:hover {
        background: rgba(108, 99, 255, 0.05);
        transform: translateY(-3px);
    }

    .stat-number {
        font-size: 1.8rem;
        font-weight: 800;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        margin-bottom: 5px;
        line-height: 1;
    }

    .stat-label {
        font-size: 0.8rem;
        color: #666;
        font-weight: 500;
    }

    /* Animations */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
        .ai-chat-main-wrapper {
            flex-direction: column;
        }
        
        .ai-chat-sidebar-left,
        .ai-chat-sidebar-right {
            flex-direction: row;
            min-width: 100%;
        }
        
        .chat-feature-card {
            flex: 1;
            min-width: 0;
        }
        
        .ai-chat-container {
            min-height: 600px;
        }
    }

    @media (max-width: 992px) {
        .ai-chat-sidebar-left,
        .ai-chat-sidebar-right {
            flex-wrap: wrap;
        }
        
        .chat-feature-card {
            min-width: calc(50% - 12.5px);
        }
        
        .quick-questions-grid {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {
        .ai-chat-section {
            padding: 80px 0;
        }
        
        .ai-chat-sidebar-left,
        .ai-chat-sidebar-right {
            flex-direction: column;
        }
        
        .chat-feature-card {
            min-width: 100%;
        }
        
        .ai-chat-header {
            padding: 20px;
        }
        
        .chat-header-content {
            flex-wrap: wrap;
        }
        
        .chat-status {
            margin-left: 0;
            margin-top: 10px;
        }
        
        .message-content {
            max-width: 85%;
        }
        
        .ai-chat-messages {
            padding: 20px;
            max-height: 400px;
        }
        
        .stats-grid {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .feature-item {
            padding: 12px;
        }
    }

    @media (max-width: 576px) {
        .chat-feature-card {
            padding: 20px;
        }
        
        .ai-chat-container {
            border-radius: 20px;
        }
        
        .quick-questions-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .feature-card-header h3 {
            font-size: 1.2rem;
        }
        
        .chat-header-text h3 {
            font-size: 1.4rem;
        }
    }
</style>

<script>
    // AI Chat functionality
    document.addEventListener('DOMContentLoaded', function() {
        // DOM Elements
        const aiChatMessages = document.getElementById('aiChatMessages');
        const chatMessageInput = document.getElementById('chatMessageInput');
        const sendChatButton = document.getElementById('sendChatButton');
        const typingIndicator = document.getElementById('typingIndicator');
        const quickQuestionBtns = document.querySelectorAll('.quick-question-btn');
        
        // Hide typing indicator initially
        typingIndicator.style.display = 'none';
        
        // Format time
        function formatTime(date = new Date()) {
            return date.toLocaleTimeString('en-KE', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
        }
        
        // Add message to AI chat
        function addAIMessage(content, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}-message`;
            
            const senderName = sender === 'user' ? 'You' : 'Mental Health Assistant';
            const senderIcon = sender === 'user' ? 'fas fa-user' : 'fas fa-robot';
            const avatarBg = sender === 'user' ? 'var(--gradient-secondary)' : 'var(--gradient-primary)';
            
            messageDiv.innerHTML = `
                <div class="message-avatar" style="background: ${avatarBg};">
                    <i class="${senderIcon}"></i>
                </div>
                <div class="message-content">
                    <div class="message-text">
                        ${escapeHtml(content)}
                    </div>
                    <div class="message-time">${formatTime()}</div>
                </div>
            `;
            
            aiChatMessages.appendChild(messageDiv);
            scrollAIChatToBottom();
        }
        
        // Send AI chat message
        async function sendAIChatMessage() {
            const message = chatMessageInput.value.trim();
            if (!message) {
                chatMessageInput.focus();
                return;
            }
            
            // Add user message
            addAIMessage(message, 'user');
            chatMessageInput.value = '';
            
            // Show typing indicator
            typingIndicator.style.display = 'flex';
            scrollAIChatToBottom();
            
            // Disable send button
            sendChatButton.disabled = true;
            
            try {
                const response = await fetch(`${API_BASE}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        session_id: chatSessionId
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    addAIMessage(data.response, 'bot');
                } else {
                    // Show error message from API
                    let errorMessage = 'The AI service is currently unavailable. ';
                    if (data.message) {
                        errorMessage = data.message;
                    }
                    errorMessage += ' Please contact our helpline directly at +254759226354 for immediate support.';
                    addAIMessage(errorMessage, 'bot');
                }
            } catch (error) {
                console.error('Chat error:', error);
                addAIMessage('Unable to connect to AI service. Please contact our helpline at +254759226354 for immediate support.', 'bot');
            } finally {
                typingIndicator.style.display = 'none';
                sendChatButton.disabled = false;
                chatMessageInput.focus();
                chatMessageInput.style.height = 'auto';
            }
        }
        
        // Scroll AI chat to bottom
        function scrollAIChatToBottom() {
            setTimeout(() => {
                aiChatMessages.scrollTop = aiChatMessages.scrollHeight;
            }, 100);
        }
        
        // Quick question buttons
        quickQuestionBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const question = this.dataset.question;
                if (question) {
                    chatMessageInput.value = question;
                    chatMessageInput.focus();
                    
                    // Auto-resize textarea
                    chatMessageInput.style.height = 'auto';
                    chatMessageInput.style.height = Math.min(chatMessageInput.scrollHeight, 120) + 'px';
                    
                    // Add a small animation to the clicked button
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 200);
                }
            });
        });
        
        // AI Chat event listeners
        sendChatButton.addEventListener('click', sendAIChatMessage);
        
        chatMessageInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendAIChatMessage();
            }
        });
        
        // Auto-resize textarea
        chatMessageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });
        
        // Load AI chat history
        async function loadAIChatHistory() {
            try {
                const response = await fetch(`${API_BASE}/chat/history/${chatSessionId}`);
                if (response.ok) {
                    const messages = await response.json();
                    
                    // Clear initial message if we have history
                    if (messages.length > 0) {
                        aiChatMessages.innerHTML = '';
                        
                        messages.forEach(msg => {
                            const messageDiv = document.createElement('div');
                            messageDiv.className = `chat-message ${msg.role}-message`;
                            
                            const senderName = msg.role === 'user' ? 'You' : 'Mental Health Assistant';
                            const senderIcon = msg.role === 'user' ? 'fas fa-user' : 'fas fa-robot';
                            const avatarBg = msg.role === 'user' ? 'var(--gradient-secondary)' : 'var(--gradient-primary)';
                            
                            const time = msg.timestamp ? formatTime(new Date(msg.timestamp)) : 'Just now';
                            
                            messageDiv.innerHTML = `
                                <div class="message-avatar" style="background: ${avatarBg};">
                                    <i class="${senderIcon}"></i>
                                </div>
                                <div class="message-content">
                                    <div class="message-text">
                                        ${escapeHtml(msg.content)}
                                    </div>
                                    <div class="message-time">${time}</div>
                                </div>
                            `;
                            
                            aiChatMessages.appendChild(messageDiv);
                        });
                    }
                } else {
                    throw new Error('Failed to load chat history');
                }
            } catch (error) {
                console.log('No chat history found or API not available');
                // Keep the initial welcome message
            }
        }
        
        // Initialize AI chat
        loadAIChatHistory();
        
        // Update stats with random animations
        function animateStats() {
            const stats = {
                activeUsers: [250, 275, 300, 325],
                avgResponse: [2.3, 2.1, 2.4, 2.2],
                satisfaction: [98, 97, 99, 98]
            };
            
            // Randomly update stats every 10 seconds
            setInterval(() => {
                const activeUsers = document.getElementById('activeUsers');
                const avgResponse = document.getElementById('avgResponse');
                const satisfaction = document.getElementById('satisfaction');
                
                if (activeUsers) {
                    const randomIndex = Math.floor(Math.random() * stats.activeUsers.length);
                    activeUsers.textContent = stats.activeUsers[randomIndex] + '+';
                    activeUsers.style.animation = 'none';
                    setTimeout(() => {
                        activeUsers.style.animation = 'fadeInUp 0.5s ease';
                    }, 10);
                }
                
                if (avgResponse) {
                    const randomIndex = Math.floor(Math.random() * stats.avgResponse.length);
                    avgResponse.textContent = stats.avgResponse[randomIndex] + 's';
                    avgResponse.style.animation = 'none';
                    setTimeout(() => {
                        avgResponse.style.animation = 'fadeInUp 0.5s ease';
                    }, 10);
                }
                
                if (satisfaction) {
                    const randomIndex = Math.floor(Math.random() * stats.satisfaction.length);
                    satisfaction.textContent = stats.satisfaction[randomIndex] + '%';
                    satisfaction.style.animation = 'none';
                    setTimeout(() => {
                        satisfaction.style.animation = 'fadeInUp 0.5s ease';
                    }, 10);
                }
            }, 10000);
        }
        
        // Start stats animation
        setTimeout(animateStats, 2000);
        
        // Add emergency button hover effects
        const emergencyBtns = document.querySelectorAll('.emergency-contact-btn');
        emergencyBtns.forEach(btn => {
            btn.addEventListener('mouseenter', function() {
                const icon = this.querySelector('.emergency-icon i');
                if (icon) {
                    icon.style.transform = 'scale(1.2) rotate(5deg)';
                }
            });
            
            btn.addEventListener('mouseleave', function() {
                const icon = this.querySelector('.emergency-icon i');
                if (icon) {
                    icon.style.transform = '';
                }
            });
        });
        
        // Add feature card animations
        const featureCards = document.querySelectorAll('.chat-feature-card');
        featureCards.forEach((card, index) => {
            card.style.animationDelay = `${index * 0.1}s`;
            card.style.animation = 'fadeInUp 0.5s ease forwards';
            card.style.opacity = '0';
        });
        
        // Focus on chat input after page load
        setTimeout(() => {
            // Auto-focus on chat input when user scrolls to chat section
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // chatMessageInput.focus();
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.5 });
            
            const chatSection = document.querySelector('.ai-chat-section');
            if (chatSection) {
                observer.observe(chatSection);
            }
        }, 1000);
        
        // Clear chat function (optional - can be added as a button)
        function addClearChatOption() {
            const clearBtn = document.createElement('button');
            clearBtn.innerHTML = '<i class="fas fa-trash-alt"></i> Clear Chat';
            clearBtn.className = 'btn btn-secondary';
            clearBtn.style.marginTop = '15px';
            clearBtn.style.fontSize = '0.9rem';
            clearBtn.style.padding = '10px 20px';
            clearBtn.style.width = '100%';
            clearBtn.style.borderRadius = '12px';
            clearBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to clear the chat history? This cannot be undone.')) {
                    aiChatMessages.innerHTML = '';
                    const welcomeMessage = "Hello! I'm your ElmedWellmindSolutions, today I willm be your AI mental health assistant. I'm here to provide supportive information, coping strategies, and general mental health guidance. How can I help you today?";
                    
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'chat-message bot-message';
                    messageDiv.innerHTML = `
                        <div class="message-avatar" style="background: var(--gradient-primary);">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content">
                            <div class="message-text">
                                ${welcomeMessage}
                            </div>
                            <div class="message-time">Just now</div>
                        </div>
                    `;
                    
                    aiChatMessages.appendChild(messageDiv);
                    chatSessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('chatSessionId', chatSessionId);
                    
                    // Show notification
                    const notification = document.createElement('div');
                    notification.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: var(--gradient-primary);
                        color: white;
                        padding: 15px 25px;
                        border-radius: 12px;
                        box-shadow: 0 10px 30px rgba(108, 99, 255, 0.3);
                        z-index: 10000;
                        animation: fadeInUp 0.3s ease;
                    `;
                    notification.innerHTML = '<i class="fas fa-check-circle"></i> Chat cleared successfully';
                    document.body.appendChild(notification);
                    
                    setTimeout(() => {
                        notification.style.opacity = '0';
                        notification.style.transform = 'translateY(-20px)';
                        setTimeout(() => notification.remove(), 300);
                    }, 3000);
                }
            });
            
            // Add to tips card or create new section
            const tipsCard = document.querySelector('.tips-card');
            if (tipsCard) {
                tipsCard.appendChild(clearBtn);
            }
        }
        
        // Uncomment to add clear chat button
        // addClearChatOption();
    });
</script>