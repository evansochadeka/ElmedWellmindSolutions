<!-- Contact Section -->
<section id="contact" class="contact-section">
    <!-- Background Pattern -->
    <div class="contact-pattern"></div>
    
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Get in Touch</h2>
            <p class="section-subtitle">Reach out to us for support, questions, or to schedule a consultation. We're here to help you on your wellness journey.</p>
        </div>
        
        <!-- Email Status Messages -->
        <div id="formMessages" style="display: none;"></div>
        
        <div class="contact-wrapper">
            <!-- Contact Information -->
            <div class="contact-info">
                <div class="contact-card">
                    <div class="contact-icon">
                        <i class="fas fa-headset"></i>
                    </div>
                    <h3>Contact Information</h3>
                    <p>We're here to listen and support you every step of the way.</p>
                    
                    <div class="contact-details">
                        <div class="contact-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <div>
                                <h4>Our Location</h4>
                                <p>Kahawa Wendani, Thika Road<br>Nairobi, Kenya</p>
                            </div>
                        </div>
                        
                        <div class="contact-item">
                            <i class="fas fa-phone"></i>
                            <div>
                                <h4>Phone Number</h4>
                                <p><a href="tel:+254759226354">+254 759 226354</a></p>
                                <small>Available 24/7 for emergencies</small>
                            </div>
                        </div>
                        
                        <div class="contact-item">
                            <i class="fas fa-envelope"></i>
                            <div>
                                <h4>Email Address</h4>
                                <p><a href="mailto:elijahokware@gmail.com">elijahokware@gmail.com</a></p>
                                <small>Response within 24 hours</small>
                            </div>
                        </div>
                        
                        <div class="contact-item">
                            <i class="fab fa-whatsapp"></i>
                            <div>
                                <h4>WhatsApp Support</h4>
                                <p><a href="https://wa.me/254759226354" target="_blank">+254 759 226354</a></p>
                                <small>Instant chat support</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Contact Buttons -->
                    <div class="quick-contact">
                        <h4><i class="fas fa-bolt"></i> Quick Actions</h4>
                        <div class="quick-buttons">
                            <button class="quick-btn whatsapp-btn" onclick="window.open('https://wa.me/254759226354', '_blank')">
                                <i class="fab fa-whatsapp"></i> WhatsApp Now
                            </button>
                            <button class="quick-btn call-btn" onclick="window.location.href='tel:+254759226354'">
                                <i class="fas fa-phone"></i> Call Now
                            </button>
                            <button class="quick-btn email-btn" onclick="window.location.href='mailto:elijahokware@gmail.com'">
                                <i class="fas fa-envelope"></i> Email Directly
                            </button>
                        </div>
                    </div>
                    
                    <div class="emergency-contact">
                        <h4><i class="fas fa-exclamation-triangle"></i> Emergency Contacts</h4>
                        <p>If you're in crisis, contact:</p>
                        <ul>
                            <li><strong>Nairobi Women's Hospital Crisis Line:</strong> 0800 720 720</li>
                            <li><strong>Kenya Red Cross:</strong> 1199</li>
                            <li><strong>Emergency Police:</strong> 999 or 112</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Contact Form -->
            <div class="contact-form-wrapper">
                <div class="contact-form-card">
                    <h3>Send Us a Message</h3>
                    <p>Fill out the form below and we'll get back to you as soon as possible.</p>
                    
                    <!-- Email sending status indicator -->
                    <div id="emailStatus" style="display:none; margin-bottom: 20px; padding: 10px; border-radius: 8px; text-align: center;"></div>
                    
                    <form id="contactForm" class="contact-form">
                        <div class="form-group">
                            <label for="name">
                                <i class="fas fa-user"></i> Full Name
                            </label>
                            <input type="text" id="name" name="name" required 
                                   placeholder="Enter your full name">
                            <div class="input-feedback"></div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="email">
                                    <i class="fas fa-envelope"></i> Email Address
                                </label>
                                <input type="email" id="email" name="email" required 
                                       placeholder="Enter your email">
                                <div class="input-feedback"></div>
                            </div>
                            
                            <div class="form-group">
                                <label for="phone">
                                    <i class="fas fa-phone"></i> Phone Number
                                </label>
                                <input type="tel" id="phone" name="phone" 
                                       placeholder="Optional">
                                <div class="input-feedback"></div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="subject">
                                <i class="fas fa-tag"></i> Subject
                            </label>
                            <select id="subject" name="subject" required>
                                <option value="">Select a topic</option>
                                <option value="General Inquiry">General Inquiry</option>
                                <option value="Appointment Booking">Appointment Booking</option>
                                <option value="Therapy/Counseling">Therapy/Counseling</option>
                                <option value="Group Sessions">Group Sessions</option>
                                <option value="Corporate Services">Corporate Services</option>
                                <option value="Emergency Support">Emergency Support</option>
                                <option value="Other">Other</option>
                            </select>
                            <div class="input-feedback"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="message">
                                <i class="fas fa-comment-dots"></i> Your Message
                            </label>
                            <textarea id="message" name="message" rows="5" required 
                                      placeholder="How can we help you today?"></textarea>
                            <div class="char-count">
                                <span id="charCount">0</span>/500 characters
                            </div>
                            <div class="input-feedback"></div>
                        </div>
                        
                        <!-- Priority Selection -->
                        <div class="form-group">
                            <label>
                                <i class="fas fa-flag"></i> Priority Level
                            </label>
                            <div class="priority-selector">
                                <label class="priority-option">
                                    <input type="radio" name="priority" value="Low" checked>
                                    <span class="priority-dot low"></span>
                                    Low
                                </label>
                                <label class="priority-option">
                                    <input type="radio" name="priority" value="Medium">
                                    <span class="priority-dot medium"></span>
                                    Medium
                                </label>
                                <label class="priority-option">
                                    <input type="radio" name="priority" value="High">
                                    <span class="priority-dot high"></span>
                                    High
                                </label>
                                <label class="priority-option">
                                    <input type="radio" name="priority" value="Emergency">
                                    <span class="priority-dot emergency"></span>
                                    Emergency
                                </label>
                            </div>
                        </div>
                        
                        <!-- Privacy Consent -->
                        <div class="privacy-consent">
                            <input type="checkbox" id="privacy" name="privacy" required>
                            <label for="privacy">
                                I understand that this information will be kept confidential and secure according to our privacy policy.
                            </label>
                            <div class="input-feedback"></div>
                        </div>
                        
                        <div class="form-submit">
                            <button type="submit" class="btn-submit" id="submitBtn">
                                <i class="fas fa-paper-plane"></i>
                                <span class="btn-text">Send Message</span>
                                <span class="submit-loader"></span>
                            </button>
                            <p class="form-note">
                                <i class="fas fa-lock"></i> Your information is protected and encrypted
                            </p>
                        </div>
                    </form>
                    
                    <!-- Auto-response timer -->
                    <div class="auto-response-info">
                        <i class="fas fa-clock"></i>
                        <span>Average response time: <strong>2-4 hours</strong></span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- NEW: Contact Status Indicator -->
        <div class="contact-status">
            <div class="status-item online">
                <i class="fas fa-circle"></i>
                <span>Email System: <strong>Active</strong></span>
            </div>
            <div class="status-item">
                <i class="fas fa-check-circle"></i>
                <span>Messages encrypted</span>
            </div>
            <div class="status-item">
                <i class="fas fa-shield-alt"></i>
                <span>Privacy protected</span>
            </div>
        </div>
        
        <!-- Mental Health Resources -->
        <div class="resources-section">
            <h3>Mental Health Resources</h3>
            <div class="resources-grid">
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <h4>Coping Strategies</h4>
                    <p>Learn healthy ways to manage stress, anxiety, and depression.</p>
                    <a href="#resources" class="resource-link">Explore Strategies</a>
                </div>
                
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h4>Support Groups</h4>
                    <p>Join our community for shared experiences and mutual support.</p>
                    <a href="#community" class="resource-link">Join Community</a>
                </div>
                
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <h4>Self-Help Guides</h4>
                    <p>Access free resources and guides for mental wellness.</p>
                    <a href="#resources" class="resource-link">Download Guides</a>
                </div>
                
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <h4>Crisis App</h4>
                    <p>Download our mobile app for immediate support tools.</p>
                    <a href="#app" class="resource-link">Get the App</a>
                </div>
            </div>
        </div>
        
        <!-- FAQ Section -->
        <div class="faq-section">
            <h3>Frequently Asked Questions</h3>
            <div class="faq-container">
                <div class="faq-item">
                    <button class="faq-question">
                        How quickly will I get a response?
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="faq-answer">
                        <p>We aim to respond to all inquiries within 24 hours. For emergencies, please call our support line or use the WhatsApp chat for immediate assistance.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <button class="faq-question">
                        Is my information confidential?
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="faq-answer">
                        <p>Yes, all information shared with us is strictly confidential and protected under professional ethical guidelines and privacy laws.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <button class="faq-question">
                        What are your consultation fees?
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="faq-answer">
                        <p>We offer a sliding scale fee structure based on income. Contact us for specific pricing or to discuss financial assistance options.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <button class="faq-question">
                        Do you offer online sessions?
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="faq-answer">
                        <p>Yes, we offer both in-person and virtual consultations via secure video platforms to accommodate your needs and preferences.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Map Section -->
        <div class="map-section">
            <h3>Our Location</h3>
            <div class="map-container">
                <div class="map-placeholder">
                    <i class="fas fa-map-marked-alt"></i>
                    <p>Kahawa Wendani, Thika Road, Nairobi</p>
                    <a href="https://maps.google.com/?q=Kahawa+Wendani+Thika+Road+Nairobi" target="_blank" class="btn-map">
                        <i class="fas fa-directions"></i> Get Directions
                    </a>
                </div>
                <!-- Estimated Travel Time -->
                <div class="travel-time">
                    <i class="fas fa-car"></i>
                    <span>Estimated travel time from city center: <strong>30-45 minutes</strong></span>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    /* All previous CSS styles remain */
    /* Adding new styles for contact status */
    
    .contact-status {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin: 40px 0;
        flex-wrap: wrap;
    }
    
    .status-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 20px;
        background: #f8f9ff;
        border-radius: 50px;
        border: 2px solid #e8eaff;
    }
    
    .status-item i {
        color: #6c63ff;
    }
    
    .status-item.online i {
        color: #4CAF50;
        animation: pulse 2s infinite;
    }
    
    .status-item span {
        color: #555;
        font-size: 0.95rem;
    }
    
    .status-item strong {
        color: #1a237e;
    }
</style>

<script>
// ============================================
// EMAILJS CONFIGURATION WITH YOUR CREDENTIALS
// ============================================
const EMAILJS_CONFIG = {
    // Your Public Key from EmailJS Account
    PUBLIC_KEY: "-jbh4-jMFMMjvpP-W", // Your public key
    
    // Your Service ID from Email Services
    SERVICE_ID: "service_b7urskv", // Your service ID
    
    // Your Template ID from Email Templates
    TEMPLATE_ID: "template_8zt7r2l" // Your template ID - I noticed you wrote "emplate" but it should be "template"
};

// ============================================

document.addEventListener('DOMContentLoaded', function() {
    // Initialize EmailJS with your public key
    console.log("Initializing EmailJS with config:", EMAILJS_CONFIG);
    
    if (EMAILJS_CONFIG.PUBLIC_KEY && EMAILJS_CONFIG.PUBLIC_KEY !== "-jbh4-jMFMMjvpP-W") {
        try {
            emailjs.init(EMAILJS_CONFIG.PUBLIC_KEY);
            console.log("‚úÖ EmailJS initialized successfully");
            updateStatusIndicator('active');
        } catch (error) {
            console.error("‚ùå EmailJS initialization failed:", error);
            updateStatusIndicator('error');
        }
    } else {
        console.warn("‚ö†Ô∏è Using test EmailJS configuration");
        updateStatusIndicator('test');
    }
    
    // Character counter
    const messageTextarea = document.getElementById('message');
    const charCount = document.getElementById('charCount');
    
    if (messageTextarea && charCount) {
        messageTextarea.addEventListener('input', function() {
            const length = this.value.length;
            charCount.textContent = length;
            
            if (length > 500) {
                charCount.style.color = '#ff6b6b';
                this.style.borderColor = '#ff6b6b';
            } else if (length > 400) {
                charCount.style.color = '#ffd166';
                this.style.borderColor = '#ffd166';
            } else {
                charCount.style.color = '#888';
                this.style.borderColor = '#e0e0e0';
            }
        });
    }
    
    // FAQ toggle functionality
    const faqQuestions = document.querySelectorAll('.faq-question');
    
    faqQuestions.forEach(question => {
        question.addEventListener('click', function() {
            const faqItem = this.parentElement;
            const isActive = faqItem.classList.contains('active');
            
            document.querySelectorAll('.faq-item').forEach(item => {
                item.classList.remove('active');
            });
            
            if (!isActive) {
                faqItem.classList.add('active');
            }
        });
    });
    
    // Real-time form validation
    function setupRealTimeValidation() {
        const inputs = document.querySelectorAll('#contactForm input, #contactForm textarea, #contactForm select');
        
        inputs.forEach(input => {
            input.addEventListener('blur', function() {
                validateField(this);
            });
            
            input.addEventListener('input', function() {
                clearFieldError(this);
            });
        });
    }
    
    function validateField(field) {
        const value = field.value.trim();
        const feedback = field.parentElement.querySelector('.input-feedback');
        
        if (field.required && !value) {
            showFieldError(field, 'This field is required');
            return false;
        }
        
        if (field.type === 'email' && value) {
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailPattern.test(value)) {
                showFieldError(field, 'Please enter a valid email address');
                return false;
            }
        }
        
        if (field.id === 'name' && value.length < 2) {
            showFieldError(field, 'Name must be at least 2 characters');
            return false;
        }
        
        if (field.id === 'message' && value.length < 10) {
            showFieldError(field, 'Message must be at least 10 characters');
            return false;
        }
        
        showFieldSuccess(field);
        return true;
    }
    
    function showFieldError(field, message) {
        const feedback = field.parentElement.querySelector('.input-feedback');
        feedback.textContent = message;
        feedback.className = 'input-feedback error';
        field.style.borderColor = '#f44336';
        field.style.background = '#fff5f5';
    }
    
    function showFieldSuccess(field) {
        const feedback = field.parentElement.querySelector('.input-feedback');
        feedback.textContent = '‚úì Valid';
        feedback.className = 'input-feedback success';
        field.style.borderColor = '#4CAF50';
        field.style.background = '#f5fff5';
    }
    
    function clearFieldError(field) {
        const feedback = field.parentElement.querySelector('.input-feedback');
        feedback.textContent = '';
        feedback.className = 'input-feedback';
        field.style.borderColor = '#e0e0e0';
        field.style.background = 'white';
    }
    
    // Form submission with EmailJS
    const contactForm = document.getElementById('contactForm');
    const submitBtn = document.getElementById('submitBtn');
    const emailStatus = document.getElementById('emailStatus');
    
    if (contactForm) {
        setupRealTimeValidation();
        
        contactForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Validate all fields
            let isValid = true;
            const fields = document.querySelectorAll('#contactForm input[required], #contactForm textarea[required], #contactForm select[required]');
            
            fields.forEach(field => {
                if (!validateField(field)) {
                    isValid = false;
                }
            });
            
            // Validate privacy checkbox
            const privacy = document.getElementById('privacy');
            if (!privacy.checked) {
                showFieldError(privacy, 'You must agree to the privacy policy');
                isValid = false;
            }
            
            if (!isValid) {
                showNotification('Please fill in all required fields correctly', 'error');
                return;
            }
            
            // Show loading state
            submitBtn.disabled = true;
            submitBtn.querySelector('.btn-text').textContent = 'Sending...';
            const loader = submitBtn.querySelector('.submit-loader');
            loader.style.display = 'inline-block';
            loader.style.cssText = `
                width: 20px;
                height: 20px;
                border: 3px solid rgba(255,255,255,0.3);
                border-top: 3px solid white;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin-left: 10px;
            `;
            
            // Show sending status
            emailStatus.style.display = 'block';
            emailStatus.className = 'sending';
            emailStatus.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending your message...';
            
            // Collect form data
            const formData = {
                from_name: document.getElementById('name').value.trim(),
                from_email: document.getElementById('email').value.trim(),
                phone: document.getElementById('phone').value.trim() || 'Not provided',
                subject: document.getElementById('subject').value,
                message: document.getElementById('message').value.trim(),
                priority: document.querySelector('input[name="priority"]:checked').value,
                timestamp: new Date().toLocaleString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                }),
                to_email: 'elijahokware@gmail.com' // Your email address
            };
            
            console.log('Sending email with data:', formData);
            
            try {
                // Send email using EmailJS
                const response = await emailjs.send(
                    EMAILJS_CONFIG.SERVICE_ID,
                    EMAILJS_CONFIG.TEMPLATE_ID,
                    formData
                );
                
                console.log('‚úÖ EmailJS response:', response);
                
                if (response.status === 200) {
                    // Success
                    emailStatus.className = 'success';
                    emailStatus.innerHTML = '<i class="fas fa-check-circle"></i> Message sent successfully! We\'ll respond within 24 hours.';
                    
                    // Save to localStorage
                    saveMessageToHistory(formData);
                    
                    // Reset form
                    setTimeout(() => {
                        contactForm.reset();
                        charCount.textContent = '0';
                        
                        // Reset field styles
                        document.querySelectorAll('.form-group input, .form-group textarea, .form-group select').forEach(input => {
                            input.style.borderColor = '#e0e0e0';
                            input.style.background = 'white';
                        });
                        
                        document.querySelectorAll('.input-feedback').forEach(fb => {
                            fb.textContent = '';
                            fb.className = 'input-feedback';
                        });
                    }, 1000);
                    
                    // Show success notification
                    showNotification('Your message has been sent successfully!', 'success');
                    
                    // Play success sound (optional)
                    playSuccessSound();
                    
                } else {
                    throw new Error(`EmailJS returned status: ${response.status}`);
                }
                
            } catch (error) {
                console.error('‚ùå Error sending email:', error);
                
                // Try fallback method
                try {
                    console.log('üîÑ Trying fallback method...');
                    await sendWithFallback(formData);
                    emailStatus.className = 'success';
                    emailStatus.innerHTML = '<i class="fas fa-check-circle"></i> Message sent via backup method!';
                    showNotification('Message sent via backup method!', 'success');
                } catch (fallbackError) {
                    console.error('‚ùå Fallback also failed:', fallbackError);
                    
                    // Save locally for later
                    saveMessageToPending(formData);
                    emailStatus.className = 'error';
                    emailStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Saved offline. Will send when online.';
                    
                    showNotification('Message saved offline. Will send when you reconnect.', 'warning');
                }
                
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                submitBtn.querySelector('.btn-text').textContent = 'Send Message';
                loader.style.display = 'none';
                
                // Hide status after 5 seconds
                setTimeout(() => {
                    emailStatus.style.display = 'none';
                }, 5000);
            }
        });
    }
    
    // Fallback email sending method
    async function sendWithFallback(data) {
        // Simple fetch request as fallback
        const response = await fetch('https://api.web3forms.com/submit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                access_key: 'YOUR_WEB3FORMS_KEY', // Optional: Get from web3forms.com
                name: data.from_name,
                email: data.from_email,
                message: data.message,
                subject: data.subject
            })
        });
        
        if (!response.ok) {
            throw new Error('Fallback failed');
        }
        
        return response.json();
    }
    
    // Save message to history
    function saveMessageToHistory(data) {
        try {
            const history = JSON.parse(localStorage.getItem('contactHistory') || '[]');
            const message = {
                id: Date.now(),
                ...data,
                date: new Date().toISOString(),
                status: 'sent'
            };
            
            history.unshift(message);
            
            // Keep only last 20 messages
            if (history.length > 20) {
                history.pop();
            }
            
            localStorage.setItem('contactHistory', JSON.stringify(history));
            console.log('üíæ Message saved to history:', message.id);
        } catch (error) {
            console.error('Error saving to history:', error);
        }
    }
    
    // Save to pending messages
    function saveMessageToPending(data) {
        try {
            const pending = JSON.parse(localStorage.getItem('pendingMessages') || '[]');
            pending.push({
                ...data,
                id: Date.now(),
                date: new Date().toISOString(),
                retryCount: 0
            });
            
            localStorage.setItem('pendingMessages', JSON.stringify(pending));
            console.log('üì• Message saved to pending:', data.id);
        } catch (error) {
            console.error('Error saving to pending:', error);
        }
    }
    
    // Show notification
    function showNotification(message, type = 'info') {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <div class="notification-content">
                <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                <span>${message}</span>
                <button class="notification-close">&times;</button>
            </div>
        `;
        
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10000;
            animation: slideInRight 0.3s ease;
            max-width: 400px;
        `;
        
        document.body.appendChild(notification);
        
        // Close button
        notification.querySelector('.notification-close').addEventListener('click', () => {
            notification.remove();
        });
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
            if (notification.parentNode) {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }
        }, 5000);
    }
    
    // Update status indicator
    function updateStatusIndicator(status) {
        const statusItem = document.querySelector('.status-item.online');
        if (statusItem) {
            const icon = statusItem.querySelector('i');
            const text = statusItem.querySelector('span');
            
            switch(status) {
                case 'active':
                    icon.className = 'fas fa-circle';
                    icon.style.color = '#4CAF50';
                    text.innerHTML = 'Email System: <strong>Active</strong>';
                    break;
                case 'error':
                    icon.className = 'fas fa-circle';
                    icon.style.color = '#f44336';
                    text.innerHTML = 'Email System: <strong>Error</strong>';
                    break;
                case 'test':
                    icon.className = 'fas fa-circle';
                    icon.style.color = '#FFC107';
                    text.innerHTML = 'Email System: <strong>Test Mode</strong>';
                    break;
            }
        }
    }
    
    // Play success sound (optional)
    function playSuccessSound() {
        try {
            // Create a simple success sound
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
            oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
            oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        } catch (error) {
            console.log('Audio not supported');
        }
    }
    
    // Emergency contact animation
    const emergencyContact = document.querySelector('.emergency-contact');
    if (emergencyContact) {
        emergencyContact.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.02)';
            this.style.transition = 'transform 0.3s ease';
        });
        
        emergencyContact.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
        });
        
        // Add click effect for emergency contacts
        emergencyContact.querySelectorAll('li').forEach(li => {
            li.style.cursor = 'pointer';
            li.addEventListener('click', function() {
                const text = this.textContent;
                const number = text.match(/\d[\d\s\-]+/)?.[0];
                if (number) {
                    window.location.href = `tel:${number.replace(/\s/g, '')}`;
                }
            });
        });
    }
    
    // Auto-expand textarea
    if (messageTextarea) {
        messageTextarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });
    }
    
    // Add animation for quick buttons
    document.querySelectorAll('.quick-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 150);
        });
    });
    
    // Test EmailJS connection on load
    async function testEmailJSConnection() {
        try {
            console.log('Testing EmailJS connection...');
            // Try to send a test request
            const testResult = await emailjs.send(
                EMAILJS_CONFIG.SERVICE_ID,
                EMAILJS_CONFIG.TEMPLATE_ID,
                {
                    from_name: 'Test User',
                    from_email: 'test@example.com',
                    subject: 'Test Connection',
                    message: 'This is a test message to verify EmailJS connection.',
                    timestamp: new Date().toISOString()
                }
            );
            console.log('‚úÖ EmailJS connection test passed');
            return true;
        } catch (error) {
            console.warn('‚ö†Ô∏è EmailJS connection test failed (this is normal if not configured):', error.message);
            return false;
        }
    }
    
    // Run connection test after a delay
    setTimeout(() => {
        testEmailJSConnection();
    }, 2000);
});

// Add additional styles
const additionalStyles = `
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOutRight {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

#emailStatus.success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

#emailStatus.error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

#emailStatus.sending {
    background: #cce5ff;
    color: #004085;
    border: 1px solid #b8daff;
}

.notification-content {
    display: flex;
    align-items: center;
    gap: 10px;
}

.notification-close {
    background: none;
    border: none;
    color: white;
    font-size: 1.2rem;
    cursor: pointer;
    margin-left: auto;
}

.priority-dot.emergency {
    animation: pulse 1.5s infinite;
}
`;

// Add styles to document
const styleSheet = document.createElement("style");
styleSheet.textContent = additionalStyles;
document.head.appendChild(styleSheet);
</script>

<!-- Include EmailJS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

<!-- Test Connection Button (Hidden by default) -->
<button id="testConnectionBtn" style="position: fixed; bottom: 10px; right: 10px; background: #666; color: white; border: none; padding: 5px 10px; border-radius: 5px; font-size: 12px; z-index: 10000; opacity: 0.3;"
        onclick="testEmailConnection()">
    Test Email
</button>

<script>
// Test function for debugging
async function testEmailConnection() {
    const testData = {
        from_name: "Test User",
        from_email: "test@example.com",
        subject: "Test Email from Website",
        message: "This is a test message to verify the email system is working.",
        priority: "Low",
        timestamp: new Date().toLocaleString()
    };
    
    try {
        const response = await emailjs.send(
            "service_b7urskv",
            "template_8zt7r2l",
            testData
        );
        alert(`‚úÖ Test email sent successfully!\nStatus: ${response.status}\nText: ${response.text}`);
    } catch (error) {
        alert(`‚ùå Test email failed:\n${error.message || error}`);
    }
}
</script>
